<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Stickman Pose Transition</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
      padding: 40px;
      font-family: sans-serif;
    }
    canvas {
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <canvas id="stickman" width="400" height="500"></canvas>
  <button id="playBtn">▶ Play Once</button>

  <script type="module">
    import { StickmanEditor } from './StickmanEditor.js';

    const canvas = document.getElementById('stickman');
    const editor = new StickmanEditor(canvas);

    // 姿势1 和 姿势2，仅包含角度变动的部分
    const pose1 = {
        "chest": -90,
        "neck": -90,
        "head": -90,
        "elbowL": 107.6252000487552,
        "handL": 41.26136355334078,
        "elbowR": 141.15644994707966,
        "handR": 121.02059439486199,
        "kneeL": 50.535824890765625,
        "footL": 125.13107380107726,
        "kneeR": 122.20275211638985,
        "footR": 144.63872455648192
    };

    const pose2 = {
      // 躯干略右转（朝侧面）
      chest: -60,
      neck: -60,
      head: -60,

      // 右臂前冲出拳
      elbowR: -10,
      handR: -10,
      palmR: -10,

      // 左臂收起防守
      elbowL: 130,
      handL: 110,
      palmL: 90,

      // 前腿（右腿）弯曲支撑
      kneeR: 110,
      footR: 95,
      soleR: 75,

      // 后腿（左腿）伸展保持平衡
      kneeL: 70,
      footL: 85,
      soleL: 105
    };

    // 动画持续时间（毫秒）
    const duration = 1000;

    // 线性插值姿势
    function interpolatePose(p1, p2, t) {
      const result = {};
      for (const key in p1) {
        if (p2.hasOwnProperty(key)) {
          result[key] = p1[key] + (p2[key] - p1[key]) * t;
        }
      }
      return result;
    }

    function playOnce() {
      const startTime = performance.now();

      function step(now) {
        const elapsed = now - startTime;
        const t = Math.min(elapsed / duration, 1);
        const pose = interpolatePose(pose1, pose2, t);
        editor.drawPose(200, 250, pose);
        if (t < 1) requestAnimationFrame(step);
      }

      requestAnimationFrame(step);
    }

    document.getElementById('playBtn').addEventListener('click', playOnce);

    // 初始显示姿势1
    editor.drawPose(200, 250, pose1);
  </script>
</body>
</html>
