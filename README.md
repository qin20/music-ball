# 🎶 音乐小球短视频项目详细介绍

## 🎯 项目定位与用途
『音乐小球』项目是一个基于 **流行歌曲MIDI文件驱动** 的可视化动画系统。结合了前端动画渲染（Canvas/WebGL）、后端数据计算与处理（NestJS）、实时音乐合成（Tone.js），最终导出为高质量短视频上传到各大视频平台，通过流量获取收益。用户想在小球视频动画中添加一些概率+奖励（变量酬赏、期待-反馈）乐趣，以达到吸引用户观看评论关注等，但是不能音效或者改变原歌曲音调。

---

## 🚀 核心功能说明

### 1. 🎵 MIDI 音乐数据解析
- 用户从网上下载midi文件，上传到系统后传给后端

### 2. ⚙️ 小球运动路径与墙体计算（后端生成）
- NestJS 后端不仅负责解析 MIDI 数据，还会基于前端传入的小球初始参数：
  - 只有一个球
  - 小球尺寸（直径）
  - 运动速度
  - 初始发射角度（限定为45°倍数，如45°、90°、135°等）
- **一次性随机生成完整的小球运动路径数据**，包括：
  - 运动轨迹上的**所有碰撞点**
  - 动态墙体布局的精确位置（随机生成，保证不重叠）
- 计算与设计原则：
  - 墙体严格为**水平或垂直**方向，随机分布，保证绝不重叠。
  - 小球在每个音符的节奏点，都会生成一面墙（随机垂直和水平）
  - 小球在撞击墙体后，进行反射，并且墙体会有碎裂的粒子效果，并且墙体会根据音符变成对应的颜色。
  - 墙体的长度等于小球的直径，厚度等于小球的四分之一。
  - 小球运动严格遵守物理定律（入射角=反射角）。
  - 小球轨迹每经过一个区域，都会消除以**小球轨迹为对角线的矩形区域**内的墙体，形成清晰的视觉通道。
  - 小球运动中**绝不会穿越任何墙体**，保证物理真实性。
- 以上数据在后端计算完成，一次性返回前端，确保算法安全，避免被轻易复制。
- 前端根据返回的数据驱动小球动画与声音播放。

### 3. 🎹 实时音乐合成与声音播放
- 前端基于 Tone.js 实现两种声音合成器支持：
  - `FMSynth`、`AMSynth`。
- 小球每次都在音符的节奏点撞击墙体，并且根据预设好的音效演奏音符，中途不可改变音色。
- 小球每次撞击墙体触发动画特效时，同时播放对应的 MIDI 音符声音，实现声音与画面严格同步。

### 5. 🎧 音频导出功能
- 完整动画和对应声音可导出为标准音频文件（WAV/WebM）。
- 导出文件作为上传视频平台的视频音轨，确保视听同步。
- 上传到各大短视频平台获取收益（如抖音、快手、B站、YouTube）。
